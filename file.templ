package popui

import (
	"github.com/invopop/popui.go/classes"
	"github.com/invopop/popui.go/props"
	"github.com/invopop/popui.go/tailwind"
)

// fileInput is a helper that renders a file input element with common attributes.
templ fileInput(file props.InputFile, class string) {
	<input
		type="file"
		id={ file.ID }
		class={
			tailwind.Merge(
				"w-full text-base font-medium outline-none focus:outline-none focus-visible:outline-none [&::file-selector-button]:outline-none [&::file-selector-button]:inline-flex [&::file-selector-button]:items-center [&::file-selector-button]:justify-center [&::file-selector-button]:font-medium [&::file-selector-button]:font-sans [&::file-selector-button]:relative [&::file-selector-button]:tracking-tight [&::file-selector-button]:px-2 [&::file-selector-button]:py-1 [&::file-selector-button]:rounded-md [&::file-selector-button]:border [&::file-selector-button]:border-border-default-secondary [&::file-selector-button]:bg-background-accent [&::file-selector-button]:text-foreground-inverse [&::file-selector-button]:shadow-button-primary [&::file-selector-button]:mr-4 [&::file-selector-button]:cursor-pointer [&::file-selector-button]:hover:bg-background-accent-hover [&::file-selector-button]:hover:border-border-default-secondary-hover [&::file-selector-button]:active:bg-background-accent-hover [&::file-selector-button]:active:border-border-default-secondary-hover [&::file-selector-button]:active:shadow-button-pressed disabled:opacity-30 disabled:cursor-not-allowed disabled:[&::file-selector-button]:cursor-not-allowed disabled:[&::file-selector-button]:opacity-30",
				class,
			),
		}
		if file.Autofocus {
			autofocus
		}
		if file.Required {
			required
		}
		if file.Disabled {
			disabled
		}
		if file.Multiple {
			multiple
		}
		if file.Name != "" {
			name={ file.Name }
		}
		if file.Accept != "" {
			accept={ file.Accept }
		}
		if file.Capture != "" {
			capture={ file.Capture }
		}
	/>
}

// InputFile provides a basic file input component.
templ InputFile(p ...props.InputFile) {
	{{ file := props.First(p).GenerateID() }}
	<div
		if file.ID != "" {
			id={ file.ID + "-wrapper" }
		}
		class={
			tailwind.Merge(
				"flex items-center justify-start h-16 p-4 gap-2 border border-dashed border-border-default-secondary rounded-2xl",
				file.Class,
			),
		}
		{ file.Attributes... }
	>
		@fileInput(file, "")
		{ children... }
	</div>
}

// FileUpload provides a file upload component with avatar preview.
templ FileUpload(p ...props.InputFile) {
	{{ file := props.First(p).GenerateID() }}
	<div
		if file.ID != "" {
			id={ file.ID + "-wrapper" }
		}
		class={
			tailwind.Merge(
				"flex items-center gap-2 rounded-lg border border-border-default-secondary pl-1 py-1 pr-3 relative",
				file.Class,
			),
		}
		{ file.Attributes... }
	>
		if file.AvatarURL != "" {
			<img
				class={
					tailwind.Merge(
						"w-10 rounded-md",
						classes.Join(map[string]bool{
							"h-10 object-cover": file.PreviewSquare,
						}),
					),
				}
				src={ file.AvatarURL }
				alt={ file.AvatarAlt }
			/>
		} else {
			<div class="flex h-10 w-10 items-center justify-center rounded-md bg-background-default-secondary border border-dashed border-border-default-secondary bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0zLjI0ODUgMy4yNDg3NUMzLjA3ODY4IDMuNDE4NTggMi45NDk5NSAzLjcxMzkzIDIuOTQ5OTUgNC4yMzAyVjExLjc5MDJDMi45NDk5NSAxMi4yODc2IDMuMDY5NDYgMTIuNTggMy4yMzAwOSAxMi43NTI2TDguMzk2MDQgNy41NzcwM0w4LjM5NjEgNy41NzY5OEM4LjYwNzg3IDcuMzY0NzYgOC44NTk0MSA3LjE5NjQgOS4xMzYzMyA3LjA4MTUyQzkuNDEzMjcgNi45NjY2NCA5LjcxMDE1IDYuOTA3NSAxMC4wMSA2LjkwNzVDMTAuMzA5OCA2LjkwNzUgMTAuNjA2NyA2Ljk2NjY0IDEwLjg4MzYgNy4wODE1MkMxMS4xNjA2IDcuMTk2NDEgMTEuNDEyMSA3LjM2NDc5IDExLjYyMzkgNy41NzcwM0wxMy4wNyA5LjAyMzA3VjQuMjMwMkMxMy4wNyAzLjcxMzkzIDEyLjk0MTIgMy40MTg1OCAxMi43NzE0IDMuMjQ4NzVDMTIuNjAxNiAzLjA3ODkyIDEyLjMwNjIgMi45NTAyIDExLjc5IDIuOTUwMkg0LjIyOTk1QzMuNzEzNjkgMi45NTAyIDMuNDE4MzMgMy4wNzg5MiAzLjI0ODUgMy4yNDg3NVpNMTEuNzkgMTMuMDcwMkg0LjMyNTk0TDkuMTAzODYgOC4yODM0M0w5LjEwMzkxIDguMjgzMzhDOS4yMjI4IDguMTY0MjMgOS4zNjQwMyA4LjA2OTcgOS41MTk1MSA4LjAwNTJDOS42NzQ5OCA3Ljk0MDcgOS44NDE2NSA3LjkwNzUgMTAuMDEgNy45MDc1QzEwLjE3ODMgNy45MDc1IDEwLjM0NSA3Ljk0MDcgMTAuNTAwNCA4LjAwNTJDMTAuNjU1OSA4LjA2OTcgMTAuNzk3MSA4LjE2NDIzIDEwLjkxNiA4LjI4MzM4TDEwLjkxNjQgOC4yODM3NkwxMy4wNyAxMC40MzczVjExLjc5MDJDMTMuMDcgMTIuMzA2NSAxMi45NDEyIDEyLjYwMTggMTIuNzcxNCAxMi43NzE2QzEyLjYwMTYgMTIuOTQxNSAxMi4zMDYyIDEzLjA3MDIgMTEuNzkgMTMuMDcwMlpNMTQuMDcgMTEuNzkwMlYxMC4yMzUxVjEwLjIyNTNWNC4yMzAyQzE0LjA3IDMuNTU5NzkgMTMuOTAyIDIuOTY1MTUgMTMuNDc4NSAyLjU0MTY0QzEzLjA1NSAyLjExODE0IDEyLjQ2MDQgMS45NTAyIDExLjc5IDEuOTUwMkg0LjIyOTk1QzMuNTU5NTUgMS45NTAyIDIuOTY0OSAyLjExODE0IDIuNTQxNCAyLjU0MTY0QzIuMTE3ODkgMi45NjUxNSAxLjk0OTk1IDMuNTU5NzkgMS45NDk5NSA0LjIzMDJWMTEuNzkwMkMxLjk0OTk1IDEyLjQ2MDYgMi4xMTc4OSAxMy4wNTUyIDIuNTQxNCAxMy40Nzg3QzIuOTY0OSAxMy45MDIzIDMuNTU5NTUgMTQuMDcwMiA0LjIyOTk1IDE0LjA3MDJIMTEuNzlDMTIuNDYwNCAxNC4wNzAyIDEzLjA1NSAxMy45MDIzIDEzLjQ3ODUgMTMuNDc4N0MxMy45MDIgMTMuMDU1MiAxNC4wNyAxMi40NjA2IDE0LjA3IDExLjc5MDJaTTQuNzcxNTIgNS42NjY3N0M0Ljk4MDYzIDUuNDU3NjcgNS4yNjQyMyA1LjM0MDE5IDUuNTU5OTUgNS4zNDAxOUM1Ljg1NTY2IDUuMzQwMTkgNi4xMzkyNyA1LjQ1NzY3IDYuMzQ4MzcgNS42NjY3N0M2LjU1NzQ3IDUuODc1ODcgNi42NzQ5NSA2LjE1OTQ4IDYuNjc0OTUgNi40NTUxOUM2LjY3NDk1IDYuNzUwOTEgNi41NTc0NyA3LjAzNDUyIDYuMzQ4MzcgNy4yNDM2MkM2LjEzOTI3IDcuNDUyNzIgNS44NTU2NiA3LjU3MDE5IDUuNTU5OTUgNy41NzAxOUM1LjI2NDIzIDcuNTcwMTkgNC45ODA2MyA3LjQ1MjcyIDQuNzcxNTIgNy4yNDM2MkM0LjU2MjQyIDcuMDM0NTIgNC40NDQ5NSA2Ljc1MDkxIDQuNDQ0OTUgNi40NTUxOUM0LjQ0NDk1IDYuMTU5NDggNC41NjI0MiA1Ljg3NTg3IDQuNzcxNTIgNS42NjY3N1oiIGZpbGw9IiMwMzA3MTIiLz4KPC9zdmc+Cg==')] bg-no-repeat bg-center"></div>
		}
		<span class="flex-1 text-base text-foreground font-medium">{ file.Text }</span>
		@Button(props.Button{
			Variant: "primary",
			Type:    "button",
			Size:    "sm",
			Attributes: templ.Attributes{
				"onclick": "document.getElementById('" + file.ID + "').click();",
			},
		}) {
			Upload
		}
		@fileInput(file, "hidden")
		{ children... }
	</div>
}
